# 第2章：光场与近场光学

本章建立了光场的数学框架，从几何光学的4D光场表示扩展到包含相干性和衍射的波动光学描述。我们将探讨光场的各种表示方法，特别是Wigner分布函数如何统一几何光学和波动光学。通过学习菲涅尔和夫琅禾费衍射理论，以及空间和时间相干性概念，我们为后续章节中的高级渲染技术奠定基础。

## 学习目标

完成本章后，您将能够：
1. 理解并推导4D和5D光场的数学表示
2. 掌握全光函数的概念及其在渲染中的应用
3. 使用Wigner分布函数分析光学系统
4. 从第一性原理推导菲涅尔和夫琅禾费衍射公式
5. 量化分析光源的空间和时间相干性
6. 将光场理论应用于计算机图形学问题

## 2.1 4D和5D光场表示

### 2.1.1 光场的几何定义

光场 L(x, y, θ, φ) 描述了空间中每个点 (x, y) 沿每个方向 (θ, φ) 传播的光强度。在自由空间中，这个4D函数完全描述了光的分布。

对于计算机图形学，我们通常使用两平面参数化：
$$L(u, v, s, t)$$

其中 (u, v) 是第一个平面上的坐标，(s, t) 是第二个平面上的坐标。光线由连接这两点的直线定义。

### 2.1.2 5D光场：包含时间和波长

完整的5D光场表示为：
$$L(x, y, θ, φ, t, λ)$$

或在两平面参数化下：
$$L(u, v, s, t, τ, λ)$$

其中 τ 是时间延迟，λ 是波长。这种表示对于分析时变场景和色散效应至关重要。

### 2.1.3 光场的守恒性质

在无损介质中，光场满足亮度守恒：
$$\frac{∂L}{∂s} = 0$$

这意味着沿光线的辐射亮度保持不变（在几何光学近似下）。

## 2.2 全光函数

### 2.2.1 七维全光函数

Adelson和Bergen提出的全光函数 P(x, y, z, θ, φ, λ, t) 描述了观察者在位置 (x, y, z)、时间 t、观察方向 (θ, φ) 和波长 λ 下感知的光强度。

这个函数可以分解为：
$$P(x, y, z, θ, φ, λ, t) = ∫ L(x', y', z', θ', φ', λ, t') δ(光线约束) dx'dy'dz'dθ'dφ'$$

### 2.2.2 降维与实际应用

在实际应用中，我们通过各种假设降低全光函数的维度：
- 静态场景：消除 t
- 单色光：消除 λ  
- 空自由空间：降至4D光场

### 2.2.3 与渲染方程的关系

全光函数与渲染方程通过以下关系连接：
$$L_o(x, ω_o) = L_e(x, ω_o) + ∫_Ω f_r(x, ω_i, ω_o) L_i(x, ω_i) (ω_i · n) dω_i$$

其中光场 L 对应于入射和出射辐射亮度。

## 2.3 光学中的Wigner分布函数

### 2.3.1 Wigner分布的定义

对于光场 U(x)，其Wigner分布函数定义为：
$$W(x, k) = ∫ U^*(x - ξ/2) U(x + ξ/2) e^{-ikξ} dξ$$

其中 x 是位置，k 是空间频率（与传播角度相关）。

### 2.3.2 相空间表示

Wigner分布提供了光场在位置-角度相空间中的表示。对于4D光场，我们有：
$$W(x, y, k_x, k_y) = ∫∫ L(x - ξ_x/2, y - ξ_y/2, x + ξ_x/2, y + ξ_y/2) e^{-i(k_x ξ_x + k_y ξ_y)} dξ_x dξ_y$$

### 2.3.3 传播与变换

通过自由空间传播距离 z 后，Wigner分布变换为：
$$W'(x, k) = W(x - zk/k_0, k)$$

这是一个相空间中的剪切变换，其中 k_0 = 2π/λ。

### 2.3.4 与光线追踪的联系

在几何光学极限下，Wigner分布退化为光线的相空间表示：
$$W(x, k) → ∑_i I_i δ(x - x_i) δ(k - k_i)$$

## 2.4 菲涅尔和夫琅禾费衍射

### 2.4.1 惠更斯-菲涅尔原理

从波动方程出发，光场传播满足：
$$U(P) = \frac{1}{iλ} ∫∫_Σ U(Q) \frac{e^{ikr}}{r} cos(n, r) dΣ$$

其中 P 是观察点，Q 是孔径上的点，r 是它们之间的距离。

### 2.4.2 菲涅尔衍射

在菲涅尔近似下（近场），传播核为：
$$h(x, y; x', y') = \frac{e^{ikz}}{iλz} exp\left[\frac{ik}{2z}[(x-x')^2 + (y-y')^2]\right]$$

衍射场为：
$$U(x, y) = ∫∫ U_0(x', y') h(x, y; x', y') dx' dy'$$

### 2.4.3 夫琅禾费衍射

在远场（夫琅禾费区域），衍射简化为傅里叶变换：
$$U(x, y) = \frac{e^{ikz}}{iλz} e^{ik(x^2+y^2)/2z} \mathcal{F}\{U_0\}\left(\frac{x}{λz}, \frac{y}{λz}\right)$$

其中 $\mathcal{F}$ 表示傅里叶变换。

### 2.4.4 数值计算考虑

菲涅尔数 F = a²/(λz) 决定了使用哪种近似：
- F >> 1：几何光学
- F ≈ 1：菲涅尔衍射
- F << 1：夫琅禾费衍射

## 2.5 空间和时间相干性

### 2.5.1 互相干函数

两点间的互相干函数定义为：
$$Γ(r_1, r_2, τ) = \langle U^*(r_1, t) U(r_2, t + τ) \rangle$$

归一化后得到复相干度：
$$γ(r_1, r_2, τ) = \frac{Γ(r_1, r_2, τ)}{\sqrt{I(r_1)I(r_2)}}$$

### 2.5.2 时间相干性

时间相干性由相干时间 τ_c 和相干长度 l_c = cτ_c 表征。对于光谱宽度 Δν 的光源：
$$τ_c ≈ \frac{1}{Δν}$$

时间相干性影响干涉条纹的可见度：
$$V = |γ(τ)| = |\mathcal{F}\{S(ν)\}|$$

其中 S(ν) 是归一化光谱密度。

### 2.5.3 空间相干性

空间相干性由相干面积表征。根据van Cittert-Zernike定理，扩展非相干源产生的场的空间相干性为：
$$γ(r_1, r_2) = \frac{∫∫ I(ξ, η) e^{ik[(r_1-r_2)·(ξ,η)]/z} dξdη}{∫∫ I(ξ, η) dξdη}$$

对于均匀圆形源，相干半径为：
$$ρ_c ≈ 1.22 \frac{λz}{D}$$

其中 D 是源的直径，z 是观察距离。

### 2.5.4 相干性与渲染

在计算机图形学中，相干性影响：
- 散斑图案的形成
- 薄膜干涉的可见度
- 全息显示的质量
- 激光投影系统的设计

## 本章小结

本章建立了光场理论的数学基础，主要概念包括：

1. **4D/5D光场表示**：L(u, v, s, t, λ) 完整描述光的空间、角度和光谱分布
2. **全光函数**：七维函数 P(x, y, z, θ, φ, λ, t) 描述所有可能的视觉信息
3. **Wigner分布**：W(x, k) 统一了几何光学和波动光学的相空间表示
4. **衍射理论**：菲涅尔数 F = a²/(λz) 决定使用几何、菲涅尔或夫琅禾费近似
5. **相干性**：时间相干长度 l_c ≈ c/Δν，空间相干半径 ρ_c ≈ 1.22λz/D

这些概念为理解现代渲染技术（如光场相机、全息显示）提供了理论基础。